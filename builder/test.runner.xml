<?xml version="1.0" encoding="UTF-8"?>
<project name="test.runner"  default="run" >
    
    <property name="project.name" value="test.runner" />
                
    <import file="builder.properties.xml" />
    <import file="${builder.dir}/ant-tasks.xml" />
    
    <fail unless="sdk.dir" message="SDK dir is not set." />
    <rbm-define-tasks sdkdir="${sdk.dir}" jar="${root.dir}/libs/rbm.host.testrunner.ant.jar" />
        
    <!--
    #############################    
    ##   Process arguments     ##
    #############################
    -->
    
    <!-- List of parameters:
    target.ap        - optional, path to apk file that is required to be installed before teseter.apk is launched.
                       Normally this apk file contains your primary application under test.
    tester.apk       - required, path to apk that will be installed and launched for tests.    
    tester.filter    - optional, default to empty string (all tests are included). 
                      Filter that is used to select tests for run (f.e. "s+m+l", see FilterTestRunner)
    tester.report.dir - optional, default to current directory. Directory where report file is placed.
    tester.runner   - optional, default to com.robomorphine.test.testrunner.RobomorphineTestRunner. Determines which runner is used to run tests.
    tester.listonly - optional, defaults to false. If set to true then tests are just listed in report but they never run.
    
    -->     

    <!-- if "tester.apk" is not set, fail -->
    <fail unless="tester.apk" message="Property 'tester.apk' must be set!" />
	
	<!-- if tested.apk is not specified, assume tester tests itself -->
	<property name="target.apk" location="${tester.apk}" />	

    <!-- default tester.filter to empty string -->
    <property name="tester.filter" value="" />

    <!-- default tester.report.dir to current dir -->
    <property name="tester.report.dir" location=".\" />    

    <!-- default tester.runner to  report runner -->
    <property name="tester.runner" value="com.robomorphine.test.runner.RobomorphineTestRunner" />

    <!-- default tester.listonly to false -->
    <property name="tester.listonly" value="false" />    
    
    <!-- print all arguments -->    
    <echo>#####################################</echo>
    <echo>############# Arguments #############</echo>
    <echo>#####################################</echo>    
    <echo>target.apk:            ${target.apk}</echo>
    <echo>tester.apk:            ${tester.apk}</echo>
    <echo>tester.filter:         ${tester.filter}</echo>
    <echo>tester.report.dir:     ${tester.report.dir}</echo>
    <echo>tester.runner:         ${tester.runner}</echo>
    <echo>tester.listonly:       ${tester.listonly}</echo>
    <echo></echo>

    <!--
    #############################
    ##           Targets       ##
    #############################
    -->
            
    <target name="run" >
    	<!-- do not re-lock device, if it was already locked -->
    	<rbm-lock-device force="false" />
    	<!-- run tests -->
    	<rbm-run-tests runner="${tester.runner}" >
    		<junit dir="${tester.report.dir}" multiple="true" />
    		<apks>
    		  <tester file="${tester.apk}" />
    		  <apk file="${target.apk}" />
    		</apks>
    		<args>
    		  <logonly enable="${tester.listonly}" />
    		  <arg key="filter" value="${tester.filter}" />
    		</args>
    	</rbm-run-tests>
    </target>
    
</project>